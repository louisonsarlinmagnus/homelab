################################################################################
# MISCELLANEOUS STACK => docker stack deploy -c stacks/miscellaneous/stack.yaml miscellaneous
################################################################################

version: '3.8'

services:
  vaultwarden:
    image: vaultwarden/server:1.34.3
    deploy:
      replicas: 1
      labels:
        - traefik.enable=true
        - traefik.http.services.vaultwarden.loadbalancer.server.port=80
        - traefik.http.routers.vaultwarden.rule=Host(`mdp.lsarlinmagnus.fr`)
        - traefik.http.routers.vaultwarden.entrypoints=websecure
        - traefik.http.routers.vaultwarden.tls=true
        - traefik.http.routers.vaultwarden.tls.certresolver=ovh
        - homepage.group=Miscellaneous
        - homepage.name=Vaultwarden
        - homepage.icon=bitwarden.png
        - homepage.href=https://mdp.lsarlinmagnus.fr
    env_file:
      - ./vaultwarden/.env.secret
    environment:
      SIGNUPS_ALLOWED: "false"
      INVITATIONS_ALLOWED: "false"
      LOG_LEVEL: debug
      TZ: Europe/Paris
    volumes:
      - vaultwarden_data:/data
    networks:
      - proxy

networks:
  proxy:
    external: true

volumes:
  mealie_data:
  vaultwarden_data: